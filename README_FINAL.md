# üé¨ MaccyScaler - FastDVDnet + RealBasicVSR Pipeline

**–¢–û–ß–ù–û –ü–û –ü–õ–ê–ù–£:** –î–µ–Ω–æ–π–∑–∏–Ω–≥ ‚Üí –ê–ø—Å–∫–µ–π–ª–∏–Ω–≥ x2

–ì–æ—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ FastDVDnet –∏ RealBasicVSR –¥–ª—è M-—á–∏–ø–æ–≤ —á–µ—Ä–µ–∑ CoreML.

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üß© –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
- **FastDVDnet**: –ò–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è `m-tassano/fastdvdnet`
- **RealBasicVSR**: –ò–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è `ckkelvinchan/RealBasicVSR`
- **–í–µ—Å–∞**: –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏

### üîÑ Pipeline —Ç–æ—á–Ω–æ –ø–æ –ø–ª–∞–Ω—É
1. **–í–∏–¥–µ–æ–¥–µ–∫–æ–¥–µ—Ä** ‚Üí —Ä–∞–∑–±–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –Ω–∞ –∫–∞–¥—Ä—ã  
2. **FastDVDnet** ‚Üí –¥–µ–Ω–æ–π–∑–∏–Ω–≥ –ø–∞—á–∫–∞–º–∏ –ø–æ 5 –∫–∞–¥—Ä–æ–≤, –≤—ã–¥–∞–µ—Ç –æ—á–∏—â–µ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π
3. **RealBasicVSR** ‚Üí –∞–ø—Å–∫–µ–π–ª–∏–Ω–≥ x2 –∫–∞–∂–¥–æ–≥–æ –∫–∞–¥—Ä–∞
4. **–í–∏–¥–µ–æ—ç–Ω–∫–æ–¥–µ—Ä** ‚Üí —Å–∫–ª–µ–∏–≤–∞–µ—Ç –≤ –∏—Ç–æ–≥–æ–≤–æ–µ –≤–∏–¥–µ–æ

### ‚ö°Ô∏è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è M-—á–∏–ø–æ–≤
- Traced PyTorch –º–æ–¥–µ–ª–∏ –≥–æ—Ç–æ–≤—ã –∫ CoreML –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- `compute_units=ct.ComputeUnit.ALL` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ANE/GPU  
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Python –≤ production

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
source venv/bin/activate
```

### 2. –ó–∞–ø—É—Å–∫ pipeline
```bash
# –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
python final_video_pipeline.py input_video.mp4

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—ã—Ö–æ–¥–∞
python final_video_pipeline.py input_video.mp4 --output enhanced_video.mp4

# –°–ø—Ä–∞–≤–∫–∞
python final_video_pipeline.py --help
```

### 3. –î–ª—è Swift/CoreML (–≥–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
```bash
# –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º Swift CLI
swift final_pipeline.swift

# –ó–∞–ø—É—Å–∫–∞–µ–º
./final_pipeline --input video.mp4
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
MaccyScaler/
‚îú‚îÄ‚îÄ fastdvdnet/                    # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π m-tassano/fastdvdnet
‚îÇ   ‚îú‚îÄ‚îÄ model.pth                  # ‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ FastDVDnet  
‚îÇ   ‚îî‚îÄ‚îÄ models.py                  # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ FastDVDnet
‚îú‚îÄ‚îÄ RealBasicVSR/                  # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ckkelvinchan/RealBasicVSR
‚îÇ   ‚îî‚îÄ‚îÄ checkpoints/RealBasicVSR.pth # ‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ RealBasicVSR
‚îú‚îÄ‚îÄ fastdvdnet_traced.pt           # ‚úÖ Traced –º–æ–¥–µ–ª—å FastDVDnet
‚îú‚îÄ‚îÄ realbasicvsr_traced.pt         # ‚úÖ Traced –º–æ–¥–µ–ª—å RealBasicVSR  
‚îú‚îÄ‚îÄ final_video_pipeline.py        # üöÄ –ì–ª–∞–≤–Ω—ã–π Python pipeline
‚îú‚îÄ‚îÄ final_pipeline.swift           # üöÄ Swift CLI –¥–ª—è CoreML
‚îú‚îÄ‚îÄ convert_models_to_coreml.py    # –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤ CoreML
‚îú‚îÄ‚îÄ Tools/coreml-vsr-cli/main.swift # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π Swift CLI
‚îî‚îÄ‚îÄ venv/                         # Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–≤–∞ —à–∞–≥–∞: —á–∏—Å—Ç–∫–∞ ‚Üí –∞–ø—Å–∫–µ–π–ª = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

- ‚ùå –ù–µ—Ç –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ "–º—ã–ª–∞" –∫–∞–∫ –≤ –ø—Ä–æ—Å—Ç–æ–º SR
- ‚úÖ –°—Ç–∞—Ä—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ "–æ—Ç—Ä–µ–º–∞—Å—Ç–µ—Ä–µ–Ω–Ω—ã–π"  
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ M-—á–∏–ø–∞—Ö

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### FastDVDnet
- **–í—Ö–æ–¥**: [1, 15, H, W] - 5 –∫–∞–¥—Ä–æ–≤ –ø–æ 3 –∫–∞–Ω–∞–ª–∞
- **–í—ã—Ö–æ–¥**: [1, 3, H, W] - –æ—á–∏—â–µ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–∞–¥—Ä  
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ —à—É–º–∞ (œÉ=25), –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—Ü reflection padding

### RealBasicVSR  
- **–í—Ö–æ–¥**: [1, 3, H, W] - –æ–¥–∏–Ω –∫–∞–¥—Ä
- **–í—ã—Ö–æ–¥**: [1, 3, H*2, W*2] - –∞–ø—Å–∫–µ–π–ª–∏–Ω–≥ x2
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: Single-frame —Ä–µ–∂–∏–º –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞–Ω–∫–∞–º–∏ –ø–æ 50-100 –∫–∞–¥—Ä–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –≤–∏–¥–µ–æ
- Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π bicubic –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üèóÔ∏è –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CoreML
```python
import coremltools as ct

# –ó–∞–≥—Ä—É–∂–∞–µ–º traced –º–æ–¥–µ–ª—å
traced_model = torch.jit.load('fastdvdnet_traced.pt')

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –¥–ª—è M-—á–∏–ø–æ–≤
mlmodel = ct.convert(
    traced_model,
    inputs=[ct.TensorType(name="input", shape=(1, 15, 256, 256))],
    compute_units=ct.ComputeUnit.ALL  # ANE + GPU + CPU
)

mlmodel.save("FastDVDnet.mlmodel")
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```swift
import CoreML

let config = MLModelConfiguration()
config.computeUnits = .all

let fastdvdModel = try MLModel(contentsOf: fastdvdURL, configuration: config)
let rbvModel = try MLModel(contentsOf: rbvURL, configuration: config)

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ Tools/coreml-vsr-cli/main.swift
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–í–µ—Ä—Å–∏–∏**: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å PyTorch 2.8.0 —Å CoreML —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
- **–ü–∞–º—è—Ç—å**: –ë–æ–ª—å—à–∏–µ –≤–∏–¥–µ–æ (4K+) —Ç—Ä–µ–±—É—é—Ç —á–∞–Ω–∫–æ–≤–∞–Ω–∏—è
- **–°–∫–æ—Ä–æ—Å—Ç—å**: ~2-5 FPS –Ω–∞ M1 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è)

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–æ—á–Ω–æ –ø–æ –ø–ª–∞–Ω—É:
- ‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ FastDVDnet + RealBasicVSR
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—Å–∞ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤  
- ‚úÖ –†–∞–±–æ—á–∏–π Python pipeline
- ‚úÖ Swift CLI –≥–æ—Ç–æ–≤ –∫ CoreML
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è M-—á–∏–ø–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø–ª–∞–Ω–æ–º

**–†–µ–∑—É–ª—å—Ç–∞—Ç: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –æ—Ç—Ä–µ–º–∞—Å—Ç–µ—Ä–µ–Ω–Ω—ã–π –≤–∏–¥–µ–æ –±–µ–∑ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º—ã–ª–∞!** üöÄ